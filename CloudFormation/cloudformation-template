AWSTemplateFormatVersion: "2010-09-09"
Description: "Create EC2 instance with website deployment using UserData"

Resources:

  WebServerInstance:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: ami-02b8269d5e85954ef     #  Change Accordinly
      InstanceType: t2.micro
      KeyName: faisal                    # Change Accordinly
      SecurityGroupIds:
        - sg-06becf8eeaf3e7dd9           # Change Accordinly
      SubnetId: subnet-042c03481f1557a8f # Change Accordinly
      Tags:
        - Key: Name
          Value: website
      UserData:
        Fn::Base64: !Sub |
          #!/bin/bash
          sudo su
          apt update -y
          apt install -y apache2 unzip wget pipx
          pipx install gdown
          pipx ensurepath
          source ~/.bashrc
          systemctl start apache2
          systemctl enable apache2

          gdown 1H9RaSCEx1pvBupx2qcDvcN1E7YLdcl2B -O neogym.zip
          unzip -o neogym.zip
          cp -r neogym-html/* /var/www/html/
          systemctl restart apache2

Outputs:
  InstanceID:
    Description: "EC2 Instance ID"
    Value: !Ref WebServerInstance
