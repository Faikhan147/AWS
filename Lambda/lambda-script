import boto3

def lambda_handler(event, context):
    ec2 = boto3.client('ec2')

    user_data_script = """#!/bin/bash
sudo su
apt update -y
apt install -y apache2 unzip wget pipx
pipx install gdown
pipx ensurepath
source ~/.bashrc
systemctl start apache2
systemctl enable apache2

gdown 1H9RaSCEx1pvBupx2qcDvcN1E7YLdcl2B -O neogym.zip
unzip -o neogym.zip
cp -r neogym-html/* /var/www/html/
systemctl restart apache2
"""

    response = ec2.run_instances(
        ImageId='ami-02b8269d5e85954ef',  # Change Accordinly
        InstanceType='t2.micro',
        MinCount=1,
        MaxCount=1,
        KeyName='faisal',  # Change Accordinly
        SecurityGroupIds=['sg-06becf8eeaf3e7dd9'],   # Change Accordinly
        SubnetId='subnet-042c03481f1557a8f',     # Change Accordinly
        UserData=user_data_script,
        TagSpecifications=[
            {
                'ResourceType': 'instance',
                'Tags': [
                    {'Key': 'Name', 'Value': 'website'}
                ]
            }
        ]
    )

    return "EC2 Created Successfully With Website and Name Tag!"
